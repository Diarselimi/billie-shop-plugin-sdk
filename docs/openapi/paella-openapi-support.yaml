openapi: 3.0.0
info:
  title: 'Billie - PaD API Documentation'
  description: |
    # Introduction
    
    The PaD API provides an easy way to integrate both client and server-side 
    with our __Billie Pay After Delivery (PaD)__ platform.
    
    _Billie PaD_ is a Business to Business (B2B) platform that enables you (the merchant) to accept invoice payments from
    other business customers without having to wait for the money to arrive, caring about reminding customers to pay,
    or taking over any credit risk.
    
    Based upon your contractual agreement with Billie, your customers will have 14, 30, 45, 60, 90 or 120 days (payment terms) 
    to pay your invoices while Billie will transfer the money to you immediately after shipment of product or fulfilment of
    service obligation.
    
    If customers get late with paying their outstanding invoices, Billie will also take over reminding customers on your behalf 
    (white label solution). In case of your customer's bankruptcy, Billie fully covers this default for you.
    
    ---
    
    ## Order States
    
    | State       | Description                                                                                   |
    |-------------|-----------------------------------------------------------------------------------------------|
    | waiting     | The order creation failed and needs a manual operation in order to be approved or declined    |
    | authorized  | The order is valid but it needs a confirmation from the merchant in order to be approved      |
    | created     | The order is successfully approved and Billie can offer financing for this transaction        |
    | declined    | The order was declined and no financing is offered for this transaction                       |
    | shipped     | The order was successfully shipped by the merchant                                            |
    | paid_out    | The outstanding amount for the respective order was successfully paid out to the merchant     |
    | late        | The payment of the outstanding amount is overdue                                              |
    | complete    | The outstanding amount was successfully paid back by the customer                             |
    | canceled    | The order was canceled by the merchant       
    
    ## Order State Transitions
    
    ![img](src/Resources/docs/orders-workflow-public.png)
    
    ## Order Decline Reasons
    
    An order could be declined by any of these reasons:
    
    | Reason                | Description                                               |
    |-----------------------|-----------------------------------------------------------|
    | debtor_address        | Debtor address or name mismatch                           |
    | debtor_not_identified | Debtor could not be identified with the information given |
    | risk_policy           | Risk decline                                              |
    | debtor_limit_exceeded | Financing limit of debtor currently exceeded              |
    
    
    ## Usage of Virtual IBANs
    
    Since the money gets paid out to the merchant directly after shipment of the product or delivery of the agreed service, 
    customers need to transfer the money directly to Billie when their invoice is due. Therefore Billie is using virtual IBANs 
    that are delivered back to the merchant as an answer of a API order creation request. Virtual IBANs are unique for each of 
    your debtor / customer. The virtual IBAN needs to be put on the invoice which the customer receives for the purchase.
    
  termsOfService: 'https://www.billie.io/agb/'
  license:
    name: 'Â© Billie GmbH, 2019'
    url: 'https://www.billie.io/agb/'
  version: 2.7.0
  x-logo:
    url: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIyLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkViZW5lXzJfS29waWUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIKCSB5PSIwcHgiIHZpZXdCb3g9IjAgMCA0OC41IDY3LjYiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQ4LjUgNjcuNjsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJLnN0MHtkaXNwbGF5Om5vbmU7ZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDo3O3N0cm9rZS1taXRlcmxpbWl0OjEwO30KCS5zdDF7ZmlsbDojMUYyNTMwO30KCS5zdDJ7ZmlsbDpub25lO30KCS5zdDN7ZGlzcGxheTpub25lO2VuYWJsZS1iYWNrZ3JvdW5kOm5ldyAgICA7fQoJLnN0NHtmb250LWZhbWlseTonQXZlbmlyTmV4dC1EZW1pQm9sZCc7fQoJLnN0NXtmb250LXNpemU6My4wMzAzcHg7fQoJLnN0NntsZXR0ZXItc3BhY2luZzoyO30KPC9zdHlsZT4KPHBhdGggY2xhc3M9InN0MCIgZD0iTTkuOCw0Ni4xYy0wLjUsMCwyNS4xLTEyLjYsMjUuMS0zMi43YzAtNi45LTUuNi0xMi42LTEyLjYtMTIuNlM5LjcsNi41LDkuNywxMy40TDkuOCw0Ni4xaDE4LjUKCWM2LjksMCwxMi42LTUuNiwxMi42LTEyLjZTMzUuMiwyMSwyOC4yLDIxSDkuNyIvPgo8Zz4KCTxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yOC4yLDQ3SDguOHYtMC44YzAtMC4xLDAtMC4yLDAtMC4zVjEzLjVDOC44LDYsMTQuOSwwLDIyLjMsMHMxMy41LDYsMTMuNSwxMy41YzAsMi44LTAuNSw1LjUtMS40LDguMgoJCWM0LjMsMi4yLDcuMyw2LjcsNy4zLDExLjlDNDEuNyw0MSwzNS42LDQ3LDI4LjIsNDd6IE0xMi45LDQ1LjJoMTUuM2M2LjQsMCwxMS43LTUuMywxMS43LTExLjdjMC00LjQtMi41LTguMy02LjEtMTAuMwoJCWMtMS44LDQuNC00LjgsOC43LTksMTIuOEMyMC40LDQwLjQsMTUuOCw0My41LDEyLjksNDUuMnogTTEwLjYsMjEuOXYyMi43YzEzLTcuNywxOC45LTE1LjYsMjEuNS0yMmMtMS4yLTAuNC0yLjUtMC43LTMuOS0wLjdIMTAuNgoJCXogTTEwLjYsMjAuMWgxNy42YzEuNiwwLDMuMSwwLjMsNC41LDAuOGMxLTIuOSwxLjMtNS41LDEuMy03LjRDMzQsNywyOC44LDEuOCwyMi4zLDEuOFMxMC42LDcsMTAuNiwxMy41VjIwLjF6Ii8+CjwvZz4KPHJlY3QgeD0iLTExLjEiIHk9Ii01OC43IiBjbGFzcz0ic3QyIiB3aWR0aD0iODUuNCIgaGVpZ2h0PSI0OS41Ii8+Cjx0ZXh0IHRyYW5zZm9ybT0ibWF0cml4KDEgMCAwIDEgLTEuMDQyNCA2Ny41NzcyKSIgY2xhc3M9InN0MyBzdDQgc3Q1IHN0NiI+QklMTElFPC90ZXh0Pgo8Zz4KCTxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0wLDU4LjFoMy43YzAuNCwwLDAuNywwLjEsMS4xLDAuMWMwLjQsMC4xLDAuNywwLjIsMC45LDAuNGMwLjMsMC4yLDAuNSwwLjQsMC43LDAuN2MwLjIsMC4zLDAuMywwLjcsMC4zLDEuMQoJCWMwLDAuNS0wLjIsMS0wLjUsMS4zYy0wLjMsMC40LTAuNywwLjYtMS4yLDAuOHYwYzAuNiwwLjEsMS4xLDAuMywxLjUsMC43QzYuOCw2My42LDcsNjQuMiw3LDY0LjhjMCwwLjUtMC4xLDEtMC4zLDEuMwoJCWMtMC4yLDAuNC0wLjUsMC42LTAuOCwwLjljLTAuMywwLjItMC43LDAuNC0xLjIsMC41Yy0wLjQsMC4xLTAuOSwwLjItMS4zLDAuMkgwQzAsNjcuNiwwLDU4LjEsMCw1OC4xeiBNMS43LDYyaDEuNQoJCWMwLjYsMCwxLTAuMSwxLjMtMC4zYzAuMy0wLjIsMC40LTAuNSwwLjQtMWMwLTAuNC0wLjItMC43LTAuNS0wLjljLTAuMy0wLjItMC44LTAuMy0xLjQtMC4zSDEuN0wxLjcsNjJMMS43LDYyeiBNMS43LDY2LjFoMS41CgkJYzAuMiwwLDAuNSwwLDAuNy0wLjFzMC41LTAuMSwwLjctMC4yYzAuMi0wLjEsMC40LTAuMywwLjUtMC40YzAuMS0wLjIsMC4yLTAuNCwwLjItMC44YzAtMC41LTAuMi0wLjktMC41LTEKCQljLTAuMy0wLjItMC45LTAuMy0xLjUtMC4zSDEuN1Y2Ni4xeiIvPgoJPHBhdGggY2xhc3M9InN0MSIgZD0iTTExLjEsNTguMWgxLjd2OS41aC0xLjdWNTguMXoiLz4KCTxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0xNy4zLDU4LjFoMS43djhoNHYxLjVoLTUuN1Y1OC4xeiIvPgoJPHBhdGggY2xhc3M9InN0MSIgZD0iTTI2LjUsNTguMWgxLjd2OGg0djEuNWgtNS43TDI2LjUsNTguMUwyNi41LDU4LjF6Ii8+Cgk8cGF0aCBjbGFzcz0ic3QxIiBkPSJNMzUuNyw1OC4xaDEuN3Y5LjVoLTEuN1Y1OC4xeiIvPgoJPHBhdGggY2xhc3M9InN0MSIgZD0iTTQxLjksNTguMWg2LjN2MS41aC00LjZWNjJINDh2MS40aC00LjNWNjZoNC44djEuNWgtNi41VjU4LjF6Ii8+CjwvZz4KPC9zdmc+Cg=='
    href: '#'
servers:
  -
    url: 'http://paella-core.test{num}.ozean12.com'
    description: 'Test API (No Gateway)'
    variables:
      num:
        enum:
          - '1'
          - '2'
          - '3'
          - '4'
          - '5'
          - '6'
          - '7'
          - '8'
          - '9'
          - '10'
          - '11'
          - '12'
          - '13'
          - '14'
          - '15'
          - '16'
          - '17'
          - '18'
          - '19'
        default: '16'
        description: 'Test Server Instance'
  -
    url: 'https://private-api.paella.ozean12.com/test-{num}'
    description: 'Test Private API (AWS Gateway)'
    variables:
      instance:
        default: XXXXX
        description: 'AWS Gateway instance ID'
      num:
        enum:
          - '1'
          - '2'
          - '3'
          - '4'
          - '5'
          - '6'
          - '7'
          - '8'
          - '9'
          - '10'
          - '11'
          - '12'
          - '13'
          - '14'
          - '15'
          - '16'
          - '17'
          - '18'
          - '19'
        default: '16'
        description: 'Test Server Instance'
  -
    url: 'https://paella-private-api.billie.io/api'
    description: 'Production Private API (AWS Gateway)'
  -
    url: 'https://paella-sandbox.billie.io/api/v1'
    description: 'Test Sandbox API'
  -
    url: 'https://paella.billie.io/api/v1'
    description: 'Production API'
paths:
  /healthcheck:
    get:
      tags:
        - Misc.
      summary: 'API Status'
      description: 'Check the status of the API server.'
      operationId: api_status
      responses:
        '200':
          description: Successful
          content:
            text/plain:
              schema:
                type: string
                default: 'paella is alive'
  /oauth/token:
    post:
      tags:
        - Authentication
      summary: 'Request OAuth Token'
      description: |
        <!-- Grants documentation taken from: https://oauth2.thephpleague.com/ -->
        
        ### Flow
        
        The client sends a POST request with following body parameters to the authorization server:
        
        * `grant_type` with the value `client_credentials`
        * `client_id` with the client's ID
        * `client_secret` with the client's secret
        
        The authorization server will respond with a JSON object containing the following properties:
        
        * `token_type` with the value `Bearer`
        * `expires_in` with an integer representing the TTL (in seconds) of the access token (Default is 8 hours)
        * `access_token` a JWT signed with the authorization server's private key
        
        The `access_token` should be used in the `Authorization` header together with the `Bearer` challenge to authenticate all the requests.
        
        > Example: `Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c`.
      operationId: oauth_token_create
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OauthClientCredentialsGrantRequestBodyParams'
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OauthTokenResponseBody'
  /oauth/authorization:
    get:
      tags:
        - Authentication
      summary: 'Validate OAuth Token'
      description: |
        Validates the `Authorization: Bearer XXXX` OAuth 2.0 token header and returns a successful response
        with `client_id` and `user_id` or fails if it's invalid.
      operationId: oauth_token_validate
      responses:
        '200':
          description: Successful
          content:
            application/json:
              schema:
                required:
                  - client_id
                  - scopes
                properties:
                  client_id: { $ref: '#/components/schemas/UUID' }
                  scopes: { type: array, items: { type: string }, default: [] }
                type: object
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        default:
          $ref: '#/components/responses/ServerError'
  /internal-docs:
    get:
      tags:
        - Docs
      summary: 'Internal API Docs (default)'
      operationId: docs_internal_get_default
      parameters:
        -
          name: noembed
          in: query
          description: 'Use spec URL instead of inline JSON'
          required: false
          schema:
            type: boolean
          example: 1
        -
          name: nocache
          in: query
          description: 'Do not send cache headers to the client'
          required: false
          schema:
            type: boolean
          example: 1
      responses:
        '200':
          $ref: '#/components/responses/HtmlDocument'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  '/internal-docs/{apiGroup}':
    get:
      tags:
        - Docs
      summary: 'Internal API Docs'
      operationId: docs_internal_get_by_group
      parameters:
        -
          name: apiGroup
          in: path
          description: 'API group name'
          required: true
          schema:
            $ref: '#/components/schemas/PrivateApiGroup'
        -
          name: noembed
          in: query
          description: 'Use spec URL instead of inline JSON'
          required: false
          schema:
            type: boolean
          example: 1
        -
          name: nocache
          in: query
          description: 'Do not send cache headers to the client'
          required: false
          schema:
            type: boolean
          example: 1
      responses:
        '200':
          $ref: '#/components/responses/HtmlDocument'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  '/internal-docs/{apiGroup}/billie-pad-openapi.yaml':
    get:
      tags:
        - Docs
      summary: 'Internal API Specs'
      operationId: docs_internal_get_specs
      parameters:
        -
          name: apiGroup
          in: path
          description: 'API group name'
          required: true
          schema:
            $ref: '#/components/schemas/PrivateApiGroup'
        -
          name: nocache
          in: query
          description: 'Do not send cache headers to the client'
          required: false
          schema:
            type: boolean
          example: 1
      responses:
        '200':
          $ref: '#/components/responses/YamlDocument'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  /docs:
    get:
      tags:
        - Docs
      summary: 'Public API Docs (default)'
      operationId: docs_get_default
      parameters:
        -
          name: noembed
          in: query
          description: 'Use spec URL instead of inline JSON'
          required: false
          schema:
            type: boolean
          example: 1
        -
          name: nocache
          in: query
          description: 'Do not send cache headers to the client'
          required: false
          schema:
            type: boolean
          example: 1
      responses:
        '200':
          $ref: '#/components/responses/HtmlDocument'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  '/docs/{apiGroup}':
    get:
      tags:
        - Docs
      summary: 'Public API Docs'
      operationId: docs_get_by_group
      parameters:
        -
          name: apiGroup
          in: path
          description: 'API group name'
          required: true
          schema:
            $ref: '#/components/schemas/PublicApiGroup'
        -
          name: noembed
          in: query
          description: 'Use spec URL instead of inline JSON'
          required: false
          schema:
            type: boolean
          example: 1
        -
          name: nocache
          in: query
          description: 'Do not send cache headers to the client'
          required: false
          schema:
            type: boolean
          example: 1
      responses:
        '200':
          $ref: '#/components/responses/HtmlDocument'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  '/docs/{apiGroup}/billie-pad-openapi.yaml':
    get:
      tags:
        - Docs
      summary: 'Public API Specs'
      operationId: docs_get_specs
      parameters:
        -
          name: apiGroup
          in: path
          description: 'API group name'
          required: true
          schema:
            $ref: '#/components/schemas/PublicApiGroup'
        -
          name: nocache
          in: query
          description: 'Do not send cache headers to the client'
          required: false
          schema:
            type: boolean
          example: 1
      responses:
        '200':
          $ref: '#/components/responses/YamlDocument'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  '/order/{uuid}/approve':
    post:
      tags:
        - 'Order Management'
      summary: 'Approve Order in Waiting State'
      description: 'Approves an order manually if it''s in waiting state. Otherwise this call fails.'
      operationId: order_approve
      parameters:
        -
          name: uuid
          in: path
          description: 'Order UUID'
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: 'Order approved.'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/ServerError'
  /merchant:
    post:
      tags:
        - Merchants
      summary: 'Create Merchant'
      operationId: merchant_create
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMerchantRequest'
      responses:
        '201':
          description: 'Merchant successfully created'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateMerchantResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          description: 'Request conflicts with the current state of the server.'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorsObject'
        '500':
          $ref: '#/components/responses/ServerError'
  '/order/{uuid}/add-invoice':
    post:
      tags:
        - 'Order Management'
        - Automated
      summary: 'Create Order Invoice'
      description: 'Creates a new invoice, linking an order with a file. Called automatically by the invoice uploader Lambda service.'
      operationId: order_create_invoice
      parameters:
        -
          name: uuid
          in: path
          description: 'Order UUID'
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              required:
                - file_id
                - invoice_number
              properties:
                file_id:
                  description: 'File ID in the Nachos file service.'
                  type: integer
                invoice_number:
                  description: 'Invoice number provided by the merchant.'
                  $ref: '#/components/schemas/TinyText'
              type: object
      responses:
        '201':
          description: 'Order invoice successfully created'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  '/order/{uuid}/decline':
    post:
      tags:
        - 'Order Management'
      summary: 'Decline Order in Waiting State'
      operationId: order_decline
      parameters:
        -
          name: uuid
          in: path
          description: 'Order UUID'
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: 'Order declined.'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/ServerError'
  '/debtor-company/{uuid}/limits':
    get:
      tags:
        - Debtors
      summary: 'Get Debtor Company Limits'
      operationId: get_debtor_company_limits
      parameters:
        -
          name: uuid
          in: path
          description: 'Company UUID'
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: 'Successful response'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetDebtorCompanyLimitsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  '/merchant/{id}':
    get:
      tags:
        - Merchants
      summary: 'Get Merchant'
      operationId: merchant_get
      parameters:
        -
          name: id
          in: path
          description: 'Merchant ID'
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 'Merchant Entity'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MerchantEntity'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  '/merchant-debtor/{debtorUuid}':
    get:
      tags:
        - Debtors
      summary: 'Get Debtor Details (Extended)'
      operationId: debtor_get_details_extended
      parameters:
        -
          name: debtorUuid
          in: path
          description: 'Merchant-Debtor UUID'
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 'Debtor Extended Info'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MerchantDebtorExtendedResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  /merchant-debtor/mark-duplicates:
    post:
      tags:
        - Debtors
      summary: 'Mark Merchant Debtor Duplicates'
      operationId: mark_duplicate_debtors
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                duplicates:
                  type: array
                  items: { $ref: '#/components/schemas/MarkDuplicateDebtorItem' }
                  nullable: false
              type: object
      responses:
        '204':
          description: 'Merchant debtor is marked as duplicate'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  '/order/{uuid}/mark-as-fraud':
    post:
      tags:
        - 'Order Management'
      summary: 'Mark Order As Fraud'
      operationId: mark_order_as_fraud
      parameters:
        -
          name: uuid
          in: path
          description: 'Order UUID'
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: 'Order Marked As Fraud'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/ServerError'
  '/merchant/{merchantId}/user':
    post:
      tags:
        - Authentication
      summary: 'Register Merchant User'
      operationId: register_merchant_user
      parameters:
        -
          name: merchantId
          in: path
          description: 'Merchant ID'
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterMerchantUserRequest'
      responses:
        '201':
          description: 'Merchant user was successfully registered'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  '/merchant-debtor/{merchantDebtorUuid}/synchronize':
    post:
      tags:
        - Merchants
      summary: 'Synchronize merchant_debtor address.'
      operationId: synchronize_merchant_debtor
      parameters:
        -
          name: Uuid
          in: path
          description: 'Mechant Debtor UUID'
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '200':
          description: 'Debtor synchronized successfully'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MerchantDebtorSynchronizationResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  '/order/{uuid}/trigger-failed-notifications':
    post:
      tags:
        - 'Order Management'
      summary: 'Trigger all failed order notifications'
      operationId: trigger_failed_order_notifications
      parameters:
        -
          name: uuid
          in: path
          description: 'Order UUID'
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      responses:
        '204':
          description: 'Order failed notifications were triggered successfully.'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  '/merchant-debtor/{debtorUuid}/update-company':
    post:
      tags:
        - Debtors
      summary: 'Updat Merchant Debtor Company'
      operationId: update_merchant_debtor_company
      parameters:
        -
          name: debtorUuid
          in: path
          description: 'Merchant-Debtor UUID'
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateMerchantDebtorCompanyRequest'
      responses:
        '204':
          description: 'Merchant debtor company updated'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  '/merchant-debtor/{debtorUuid}/update-limit':
    post:
      tags:
        - Debtors
      summary: 'Update Merchant Debtor Limit'
      operationId: update_merchant_debtor_limit
      parameters:
        -
          name: debtorUuid
          in: path
          description: 'Merchant Debtor UUID'
          required: true
          schema:
            $ref: '#/components/schemas/UUID'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                financing_limit:
                  description: 'New financing limit.'
                  type: number
                  format: float
              type: object
      responses:
        '204':
          description: 'Successful response'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  '/merchant-debtor/{debtorUuid}/whitelist':
    post:
      tags:
        - Debtors
      summary: 'Whitelist Merchant Debtor'
      operationId: whitelist_merchant_debtor
      parameters:
        -
          name: debtorUuid
          in: path
          description: 'Merchant-Debtor UUID'
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                is_whitelisted:
                  type: boolean
                  nullable: false
              type: object
      responses:
        '204':
          description: 'Merchant debtor is whitelisted'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
components:
  schemas:
    UUID:
      type: string
      format: uuid
      maxLength: 36
      minLength: 36
      example: 12345667-890a-bcde-f123-34567890abcd
    PublicApiGroup:
      title: 'API Group'
      type: string
      enum:
        - standard
        - checkout-server
      example: standard
    PrivateApiGroup:
      title: 'API Group'
      type: string
      enum:
        - full
        - salesforce
        - support
        - standard
        - checkout-server
        - checkout-client
        - dashboard
      example: standard
    Date:
      title: Date
      type: string
      format: date
      example: '2019-01-20'
    DateTime:
      title: Date-Time
      type: string
      format: date-time
      example: '2019-01-20 14:00:00'
    TinyText:
      title: string
      type: string
      maxLength: 255
    Money:
      title: Money
      type: number
      format: float
      pattern: '^(\d{1,}(.\d{2})?)$'
      example: 99.95
    MerchantUserRoles:
      title: 'Merchant User Roles'
      type: string
      enum:
        - ROLE_VIEW_ORDERS
        - ROLE_VIEW_DEBTORS
        - ROLE_VIEW_PAYMENTS
        - ROLE_CONFIRM_ORDER_PAYMENT
        - ROLE_PAUSE_DUNNING
      example: ROLE_VIEW_ORDERS
    OauthClientCredentialsGrantRequestBodyParams:
      title: 'Request OAuth Token'
      required:
        - grant_type
        - client_id
        - client_secret
      properties:
        grant_type:
          type: string
          const: client_credentials
        client_id:
          $ref: '#/components/schemas/UUID'
        client_secret:
          type: string
      type: object
    OauthTokenResponseBody:
      title: 'Request Oauth Token Response'
      properties:
        token_type:
          type: string
          example: Bearer
          nullable: false
        expires_in:
          description: 'TTL of the access token in seconds (Default is 8 hours)'
          type: integer
          nullable: false
        access_token:
          description: 'JWT signed with the authorization server''s private key'
          type: string
          nullable: false
      type: object
    CreateMerchantRequest:
      title: 'Merchant Data'
      properties:
        company_id:
          type: string
          format: numeric
        merchant_financing_limit:
          type: number
          format: float
        initial_debtor_financing_limit:
          type: number
          format: float
        debtor_financing_limit:
          type: number
          format: float
        webhook_url:
          type: string
          format: uri
          nullable: true
        webhook_authorization:
          description: 'Authorization header that will be sent with the merchant webhooks. Currently `X-Api-Key: XXX` and `Authorization: Basic XXX` are supported.'
          type: string
          example: 'X-Api-Key: test'
          nullable: true
      type: object
    CreateMerchantResponse:
      properties:
        oauth_client_id:
          $ref: '#/components/schemas/UUID'
        oauth_client_secret:
          $ref: '#/components/schemas/UUID'
      type: object
      allOf:
        -
          $ref: '#/components/schemas/MerchantEntity'
    GetDebtorCompanyLimitsMerchant:
      title: 'Debtor''s Merchant IDs Object'
      properties:
        id:
          type: integer
        payment_uuid:
          $ref: '#/components/schemas/UUID'
      type: object
    GetDebtorCompanyLimitsResponse:
      title: 'Debtor Company Limits Object'
      properties:
        company_id:
          type: integer
        company_uuid:
          $ref: '#/components/schemas/UUID'
        company_financing_power:
          description: 'Current available limit for this company in Platform.'
          example: 10000
          allOf:
            -
              $ref: '#/components/schemas/Money'
        merchant_debtors:
          description: 'List of debtors created in Paella for this company.'
          type: array
          items:
            properties:
              id:
                description: 'Merchant Debtor ID'
                type: integer
              uuid:
                description: 'Merchant Debtor UUID'
                $ref: '#/components/schemas/UUID'
              financing_limit:
                description: 'Full limit assigned in Paella to this debtor and merchant combination.'
                example: 2500
                allOf:
                  - { $ref: '#/components/schemas/Money' }
              financing_power:
                description: 'Current available limit in Paella for this debtor and merchant combination.'
                example: 2251.01
                allOf:
                  - { $ref: '#/components/schemas/Money' }
              merchant:
                description: 'The merchant the merchant-debtor belongs to.'
                $ref: '#/components/schemas/GetDebtorCompanyLimitsMerchant'
            type: object
      type: object
    MarkDuplicateDebtorItem:
      required:
        - debtor_id
        - is_duplicate_of
      properties:
        debtor_id:
          type: integer
        is_duplicate_of:
          type: integer
      type: object
    RegisterMerchantUserRequest:
      title: 'Register Merchant User'
      properties:
        first_name:
          type: string
          nullable: false
        last_name:
          type: string
          nullable: false
        email:
          type: string
          format: email
          nullable: false
        password:
          type: string
          format: password
          nullable: false
        roles:
          type: array
          items:
            $ref: '#/components/schemas/MerchantUserRoles'
          nullable: true
      type: object
    UpdateMerchantDebtorCompanyRequest:
      properties:
        name:
          example: 'Billie GmbH'
          $ref: '#/components/schemas/TinyText'
        address_house:
          example: '4'
          $ref: '#/components/schemas/TinyText'
        address_street:
          example: Charlottenstr.
          $ref: '#/components/schemas/TinyText'
        address_city:
          example: Berlin
          $ref: '#/components/schemas/TinyText'
        address_postal_code:
          example: '10969'
          $ref: '#/components/schemas/TinyText'
      type: object
    MerchantEntity:
      properties:
        id:
          type: integer
        created_at:
          $ref: '#/components/schemas/DateTime'
        updated_at:
          $ref: '#/components/schemas/DateTime'
        name:
          $ref: '#/components/schemas/TinyText'
        available_financing_limit:
          type: number
          format: float
        api_key:
          $ref: '#/components/schemas/TinyText'
        company_id:
          $ref: '#/components/schemas/TinyText'
        payment_merchant_id:
          $ref: '#/components/schemas/UUID'
        is_active:
          type: boolean
        webhook_url:
          type: string
          format: uri
          nullable: true
        webhook_authorization:
          type: string
          example: 'Authorization: Basic test'
          nullable: true
      type: object
    AbstractMerchantDebtorResponse:
      properties:
        id:
          description: 'Debtor UUID'
          $ref: '#/components/schemas/UUID'
        external_code:
          description: 'Merchant Customer ID'
          $ref: '#/components/schemas/TinyText'
        name:
          $ref: '#/components/schemas/TinyText'
        financing_limit:
          description: 'Full limit assigned to this merchant debtor.'
          type: number
          format: float
        financing_power:
          description: 'Current available limit for this merchant debtor.'
          type: number
          format: float
        bank_account_iban:
          $ref: '#/components/schemas/TinyText'
        bank_account_bic:
          $ref: '#/components/schemas/TinyText'
        created_at:
          $ref: '#/components/schemas/DateTime'
      type: object
    MerchantDebtorResponse:
      properties:
        address_street:
          $ref: '#/components/schemas/TinyText'
        address_house:
          nullable: true
          $ref: '#/components/schemas/TinyText'
        address_postal_code:
          $ref: '#/components/schemas/TinyText'
        address_city:
          $ref: '#/components/schemas/TinyText'
        address_country:
          $ref: '#/components/schemas/TinyText'
        outstanding_amount:
          type: number
          format: float
        outstanding_amount_created:
          type: number
          format: float
        outstanding_amount_late:
          type: number
          format: float
      type: object
      allOf:
        -
          $ref: '#/components/schemas/AbstractMerchantDebtorResponse'
    MerchantDebtorExtendedResponse:
      properties:
        merchant_debtor_id:
          type: integer
        company_id:
          type: integer
        company_uuid:
          $ref: '#/components/schemas/UUID'
        payment_id:
          $ref: '#/components/schemas/UUID'
        is_whitelisted:
          type: boolean
        is_blacklisted:
          type: boolean
        is_trusted_source:
          type: boolean
        crefo_id:
          nullable: true
          $ref: '#/components/schemas/TinyText'
        schufa_id:
          nullable: true
          $ref: '#/components/schemas/TinyText'
      type: object
      allOf:
        -
          $ref: '#/components/schemas/MerchantDebtorResponse'
    MerchantDebtorSynchronizationResponse:
      title: 'Merchant Debtor Synchronization'
      properties:
        debtor_company:
          description: 'Updated debtor company data'
          properties:
            name:
              type: string
              example: 'Some company'
            address_house_number:
              type: string
              example: '123'
            address_street:
              type: string
              example: 'Random street'
            address_postal_code:
              type: string
              example: '10356'
            address_city:
              type: string
              example: Berlin
            address_country:
              type: string
              example: Germany
          type: object
        is_updated:
          type: boolean
          example: 'true'
      type: object
    ErrorsObject:
      title: 'API Errors'
      properties:
        errors:
          type: array
          items:
            required:
              - title
              - code
            properties:
              title:
                description: 'Error message'
                type: string
              code:
                description: 'Error code'
                type: string
                nullable: true
              source:
                description: 'Property path where the error occurred, if applicable'
                type: string
                nullable: true
            type: object
      type: object
  responses:
    HtmlDocument:
      description: 'HTML Document'
      content:
        text/html:
          schema:
            type: string
    YamlDocument:
      description: 'YAML Document'
      content:
        text/x-yaml:
          schema:
            type: string
    ServerError:
      description: 'Unexpected Server Error'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorsObject'
    NotFound:
      description: 'Resource Not Found'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorsObject'
    Unauthorized:
      description: 'Unauthorized request or invalid credentials'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorsObject'
    Forbidden:
      description: 'Forbidden Request. The operation cannot be completed.'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorsObject'
    BadRequest:
      description: 'Invalid Request Data'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorsObject'
  securitySchemes:
    oauth2:
      type: oauth2
      description: |
        This authentication mechanism is based on the OAuth 2.0 prototocol and requires a Client ID, a Client Secret Key and
        in some cases also a user and password.
        
        With these credentials, the client should request a token using the `POST /api/v1/oauth/token` endpoint,
        which should be used in the `Authorization` header together with the `Bearer` challenge to authenticate all the requests.
        
        > Example: `Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c`.
      flows:
        password:
          tokenUrl: /oauth/token
          scopes:
            default: default
    apiKey:
      type: apiKey
      description: |
        This authentication mechanism is based on the `X-Api-Key` header. It has been is **deprecated**, since it is
        less secure because API Keys never expire, in comparison to OAuth tokens.
        
        > Example: `X-Api-Key: bf428b05-f80e-4ed0-aa79-e0e7bef274a3`.
      name: X-Api-Key
      in: header
tags:
  -
    name: Authentication
    description: |
      For authentication and authorisation the API requires some requests to include valid API credentials via HTTP headers.
      Different keys are used for the `sandbox` and `production` environments, which are completely independent
      meaning that they cannot access or alter data from the other.
      
      To obtain your credentials for both environments please contact us or send an email to: pad@billie.io.
  -
    name: 'Order Creation'
  -
    name: 'Order Management'
  -
    name: Debtors
  -
    name: Merchants
  -
    name: Webhooks
    description: |
      ## Incoming Webhooks
      To send updates on relevant events, Billie PaD sends POST requests to the incoming webhook URL provided by the merchant.
      The following events can be communicated via webhooks:
      
      
      ### Webhook Authentication
      The authentication for webhooks sent from Billie to the merchants incoming webhook URL depends on the merchant specifications 
      and needs, but one possibility is sending the Billie API Key via headers:
      Examples:
       - `Authorization: Basic THE_API_KEY`
       - `X-Api-Key: THE_API_KEY`
       - `X-Another-Custom-Header: THE_API_KEY`
      
      The merchants will need to verify on their server side the authentication mechanism and credentials.
      
      ### Webhook Requests
      
      A `POST` request is sent to the configured merchant Webhook URL with one of the API Key headers mentioned above,
      the `application/json` Content-Type and the following body format:
      ```
      {
          event: (string) (event name, -check the following section for more details-)
          order_id: (string)
          amount: (string) (optional) (contains sum of paid amounts)
      	open amount: (string) (optional) (contains sum of outstanding amount)
          url_notification: (string) (optional)
      }
      ```
      
      ### Event Names
      
      **General**
      
      | Event Name      | Description                                                                                                                |
      |-----------------|----------------------------------------------------------------------------------------------------------------------------|
      | order\_approved | waiting order approved                                                                                                     |
      | order\_declined | waiting order declined                                                                                                     |
      | payment         | The outstanding amount for an order changed. <br><br> This message is sent for full as well as partial payments for orders |
      
      <br>
      
      **Webhooks for Dunning & Collections**
      
      | Event Name       | Description                              |
      |------------------|------------------------------------------|
      | reminder_email_1 | 1st Reminder mail was sent               |
      | dunning_letter_1 | 1st Dunning letter was sent              |
      | dunning_email_1  | 1st Dunning mail was sent                |
      | reminder_email_2 | 2nd Reminder mail was sent               |
      | dunning_letter_2 | 2nd Dunning letter was sent              |
      | reminder_email_2 | 2nd Dunning email was sent               |
      | dunning_email_2  | 2nd Dunning email was sent               |
      | reminder_email_3 | 3rd Reminder email was sent              |
      | dca_letter       | Debt collection handover letter was sent |
      | dca_email        | Debt collection handover email was sent  |
  -
    name: Misc.
